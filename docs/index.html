<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sunburst Only</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Added: DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <!-- Added: DataTables Buttons CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
  </head>
  <body>
    <!-- メニューバー -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">d3.js Visualization : </a>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-forcelayout">D3Force2D</a> <!-- 名前変更 -->
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-force3d">D3Force3D(N/A)</a> <!-- 新規追加 -->
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#" id="menu-sunburst">Sunburst</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-datatable">TableForBusiness</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-table">TableForToyBox</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- ここから下は既存のcanvasなど -->
    <div id="canvas">
      <svg></svg>
    </div>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Added: jQuery, DataTables, JSZip and Buttons extension -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <script>
      // JSファイルを動的に読み込む関数
      function loadScript(jsFile) {
        // 既存のSVGやcanvas内容をクリア
        document.querySelector("#canvas").innerHTML = "<svg></svg>";
        // キャッシュ対策で毎回異なるクエリを付与
        const cacheBuster = Date.now();
        fetch(jsFile + '?v=' + cacheBuster)
          .then(response => response.text())
          .then(scriptContent => {
            const executeScript = new Function(scriptContent);
            executeScript();
          })
          .catch(error => {
            console.error('Error loading ' + jsFile + ':', error);
          });
      }

      // Table表示用の関数
      function showTable() {
        document.querySelector("#canvas").innerHTML = "<div id='table-container'></div>";
        document.querySelectorAll('script[data-tablejs]').forEach(s => s.parentNode.removeChild(s));
        setTimeout(function() {
          const script = document.createElement('script');
          script.src = 'table.js?v=' + Date.now();
          script.type = 'text/javascript';
          script.setAttribute('data-tablejs', 'true');
          document.body.appendChild(script);
        }, 10);
        setActiveMenu(document.getElementById('menu-table'));
      }

      // 初期表示は Table
      // 初期表示を DataTable に変更
      loadScript('datatable.js');
      setActiveMenu(document.getElementById('menu-datatable'));

      // メニュークリックで切り替え
      document.getElementById('menu-sunburst').addEventListener('click', function(e) {
        e.preventDefault();
        loadScript('sunburst.js');
        setActiveMenu(this);
      });
      document.getElementById('menu-datatable').addEventListener('click', function(e) {
        e.preventDefault();
        loadScript('datatable.js');
        setActiveMenu(this);
      });
      document.getElementById('menu-table').addEventListener('click', function(e) {
        e.preventDefault();
        showTable();
      });
      // D3-Force-2D
      document.getElementById('menu-forcelayout').addEventListener('click', function(e) {
        e.preventDefault();
        loadScript('forcelayout.js');
        setActiveMenu(this);
      });

      // D3-Force-3D: クリックで白いキャンバスのみ表示
      document.getElementById('menu-force3d').addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelector("#canvas").innerHTML = "";
        const blankDiv = document.createElement('div');
        blankDiv.style.background = "#fff";
        blankDiv.style.width = "100%";
        blankDiv.style.height = "100%";
        blankDiv.style.minHeight = "400px";
        document.querySelector("#canvas").appendChild(blankDiv);
        setActiveMenu(this);
      });

      // アクティブメニューの切り替え
      function setActiveMenu(activeElem) {
        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        activeElem.classList.add('active');
      }
    </script>
  </body>
</html>