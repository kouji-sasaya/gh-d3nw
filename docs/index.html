<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sunburst Only</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Added: DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <!-- Added: DataTables Buttons CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <!-- Bootstrap Icons CDNをhead内に追加 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  </head>
  <body>
    <!-- メニューバー -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="bi bi-diagram-3-fill"></i> d3.js Visualization :
        </a>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-datatable">
                <i class="bi bi-table"></i> BusinessTable
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-table">
                <i class="bi bi-grid-3x3-gap"></i> CasualTable
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-forcelayout">
                <i class="bi bi-diagram-3"></i> NetworkGraph2D
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-force3d">
                <i class="bi bi-graph-up"></i> NetworkGraph3D(N/A)
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#" id="menu-sunburst">
                <i class="bi bi-brightness-high"></i> Sunburst
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="menu-raw">
                <i class="bi bi-file-earmark-code"></i> Raw
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- 画面いっぱいのRaw表示用エリア -->
    <div id="canvas" style="width:100vw; height:calc(100vh - 56px); margin:0; padding:0; box-sizing:border-box;">
      <svg></svg>
    </div>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Added: jQuery, DataTables, JSZip and Buttons extension -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <script>
      // JSファイルを動的に読み込む関数
      function loadScript(jsFile) {
        document.querySelector("#canvas").innerHTML = "<svg></svg>";
        const cacheBuster = Date.now();
        fetch(jsFile + '?v=' + cacheBuster)
          .then(response => response.text())
          .then(scriptContent => {
            const executeScript = new Function(scriptContent);
            executeScript();
          })
          .catch(error => {
            console.error('Error loading ' + jsFile + ':', error);
          });
      }

      function showTable() {
        document.querySelector("#canvas").innerHTML = "<div id='table-container'></div>";
        document.querySelectorAll('script[data-tablejs]').forEach(s => s.parentNode.removeChild(s));
        setTimeout(function() {
          const script = document.createElement('script');
          script.src = 'table.js?v=' + Date.now();
          script.type = 'text/javascript';
          script.setAttribute('data-tablejs', 'true');
          document.body.appendChild(script);
        }, 10);
      }

      // アクティブメニューの切り替え
      function setActiveMenu(activeElem) {
        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        activeElem.classList.add('active');
      }

      // Raw表示用
      function showRaw() {
        document.querySelector("#canvas").innerHTML =
          `<pre id='raw-json'
            style="
              background:#222;
              color:#ffd700;
              padding:2vw;
              border-radius:16px;
              width:100vw;
              height:calc(100vh - 56px);
              margin:0;
              box-sizing:border-box;
              font-size:1.1em;
              overflow:auto;
              position:relative;
            "></pre>`;
        fetch('data.json?v=' + Date.now())
          .then(res => res.text())
          .then(text => {
            document.getElementById('raw-json').textContent = text;
          })
          .catch(err => {
            document.getElementById('raw-json').textContent = "Error loading data.json";
          });
      }

      // メニューごとの描画処理
      function showMenu(menuId) {
        switch (menuId) {
          case 'menu-datatable':
            loadScript('datatable.js');
            break;
          case 'menu-table':
            showTable();
            break;
          case 'menu-forcelayout':
            loadScript('forcelayout.js');
            break;
          case 'menu-force3d':
            document.querySelector("#canvas").innerHTML = "";
            const blankDiv = document.createElement('div');
            blankDiv.style.background = "#fff";
            blankDiv.style.width = "100%";
            blankDiv.style.height = "100%";
            blankDiv.style.minHeight = "400px";
            document.querySelector("#canvas").appendChild(blankDiv);
            break;
          case 'menu-sunburst':
            loadScript('sunburst.js');
            break;
          case 'menu-raw':
            showRaw();
            break;
          default:
            loadScript('datatable.js');
        }
        setActiveMenu(document.getElementById(menuId));
      }

      // メニュークリック時に選択状態を保存＆描画
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          localStorage.setItem('selectedMenu', this.id);
          showMenu(this.id);
        });
      });

      // ページロード時に選択メニューを復元
      window.addEventListener('DOMContentLoaded', function() {
        const selected = localStorage.getItem('selectedMenu');
        if (selected && document.getElementById(selected)) {
          showMenu(selected);
        } else {
          showMenu('menu-datatable'); // デフォルト
        }
      });
    </script>
  </body>
</html>